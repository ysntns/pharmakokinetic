{"dependencies":[{"name":"./utils.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":24},"end":{"line":2,"column":61,"index":85}}],"key":"NIaSEHO1E48gsZc7jH9Ex1xTHgE=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"streamedQuery\", {\n    enumerable: true,\n    get: function () {\n      return streamedQuery;\n    }\n  });\n  var _utilsJs = require(_dependencyMap[0], \"./utils.js\");\n  // src/streamedQuery.ts\n\n  function streamedQuery({\n    streamFn,\n    refetchMode = \"reset\",\n    reducer = (items, chunk) => (0, _utilsJs.addToEnd)(items, chunk),\n    initialValue = []\n  }) {\n    return async context => {\n      const query = context.client.getQueryCache().find({\n        queryKey: context.queryKey,\n        exact: true\n      });\n      const isRefetch = !!query && query.state.data !== void 0;\n      if (isRefetch && refetchMode === \"reset\") {\n        query.setState({\n          status: \"pending\",\n          data: void 0,\n          error: null,\n          fetchStatus: \"fetching\"\n        });\n      }\n      let result = initialValue;\n      let cancelled = false;\n      const streamFnContext = (0, _utilsJs.addConsumeAwareSignal)({\n        client: context.client,\n        meta: context.meta,\n        queryKey: context.queryKey,\n        pageParam: context.pageParam,\n        direction: context.direction\n      }, () => context.signal, () => cancelled = true);\n      const stream = await streamFn(streamFnContext);\n      const isReplaceRefetch = isRefetch && refetchMode === \"replace\";\n      for await (const chunk of stream) {\n        if (cancelled) {\n          break;\n        }\n        if (isReplaceRefetch) {\n          result = reducer(result, chunk);\n        } else {\n          context.client.setQueryData(context.queryKey, prev => reducer(prev === void 0 ? initialValue : prev, chunk));\n        }\n      }\n      if (isReplaceRefetch && !cancelled) {\n        context.client.setQueryData(context.queryKey, result);\n      }\n      return context.client.getQueryData(context.queryKey) ?? initialValue;\n    };\n  }\n});","lineCount":63,"map":[[7,2,54,0,"Object"],[7,8,54,0],[7,9,54,0,"defineProperty"],[7,23,54,0],[7,24,54,0,"exports"],[7,31,54,0],[8,4,54,0,"enumerable"],[8,14,54,0],[9,4,54,0,"get"],[9,7,54,0],[9,18,54,0,"get"],[9,19,54,0],[10,6,54,0],[10,13,55,2,"streamedQuery"],[10,26,55,15],[11,4,55,15],[12,2,55,15],[13,2,2,0],[13,6,2,0,"_utilsJs"],[13,14,2,0],[13,17,2,0,"require"],[13,24,2,0],[13,25,2,0,"_dependencyMap"],[13,39,2,0],[14,2,1,0],[16,2,3,0],[16,11,3,9,"streamedQuery"],[16,24,3,22,"streamedQuery"],[16,25,3,23],[17,4,4,2,"streamFn"],[17,12,4,10],[18,4,5,2,"refetchMode"],[18,15,5,13],[18,18,5,16],[18,25,5,23],[19,4,6,2,"reducer"],[19,11,6,9],[19,14,6,12,"reducer"],[19,15,6,13,"items"],[19,20,6,18],[19,22,6,20,"chunk"],[19,27,6,25],[19,32,6,30],[19,36,6,30,"addToEnd"],[19,44,6,38],[19,45,6,38,"addToEnd"],[19,53,6,38],[19,55,6,39,"items"],[19,60,6,44],[19,62,6,46,"chunk"],[19,67,6,51],[19,68,6,52],[20,4,7,2,"initialValue"],[20,16,7,14],[20,19,7,17],[21,2,8,0],[21,3,8,1],[21,5,8,3],[22,4,9,2],[22,11,9,9],[22,17,9,16,"context"],[22,24,9,23],[22,28,9,28],[23,6,10,4],[23,12,10,10,"query"],[23,17,10,15],[23,20,10,18,"context"],[23,27,10,25],[23,28,10,26,"client"],[23,34,10,32],[23,35,10,33,"getQueryCache"],[23,48,10,46],[23,49,10,47],[23,50,10,48],[23,51,10,49,"find"],[23,55,10,53],[23,56,10,54],[24,8,10,56,"queryKey"],[24,16,10,64],[24,18,10,66,"context"],[24,25,10,73],[24,26,10,74,"queryKey"],[24,34,10,82],[25,8,10,84,"exact"],[25,13,10,89],[25,15,10,91],[26,6,10,96],[26,7,10,97],[26,8,10,98],[27,6,11,4],[27,12,11,10,"isRefetch"],[27,21,11,19],[27,24,11,22],[27,25,11,23],[27,26,11,24,"query"],[27,31,11,29],[27,35,11,33,"query"],[27,40,11,38],[27,41,11,39,"state"],[27,46,11,44],[27,47,11,45,"data"],[27,51,11,49],[27,56,11,54],[27,61,11,59],[27,62,11,60],[28,6,12,4],[28,10,12,8,"isRefetch"],[28,19,12,17],[28,23,12,21,"refetchMode"],[28,34,12,32],[28,39,12,37],[28,46,12,44],[28,48,12,46],[29,8,13,6,"query"],[29,13,13,11],[29,14,13,12,"setState"],[29,22,13,20],[29,23,13,21],[30,10,14,8,"status"],[30,16,14,14],[30,18,14,16],[30,27,14,25],[31,10,15,8,"data"],[31,14,15,12],[31,16,15,14],[31,21,15,19],[31,22,15,20],[32,10,16,8,"error"],[32,15,16,13],[32,17,16,15],[32,21,16,19],[33,10,17,8,"fetchStatus"],[33,21,17,19],[33,23,17,21],[34,8,18,6],[34,9,18,7],[34,10,18,8],[35,6,19,4],[36,6,20,4],[36,10,20,8,"result"],[36,16,20,14],[36,19,20,17,"initialValue"],[36,31,20,29],[37,6,21,4],[37,10,21,8,"cancelled"],[37,19,21,17],[37,22,21,20],[37,27,21,25],[38,6,22,4],[38,12,22,10,"streamFnContext"],[38,27,22,25],[38,30,22,28],[38,34,22,28,"addConsumeAwareSignal"],[38,42,22,49],[38,43,22,49,"addConsumeAwareSignal"],[38,64,22,49],[38,66,23,6],[39,8,24,8,"client"],[39,14,24,14],[39,16,24,16,"context"],[39,23,24,23],[39,24,24,24,"client"],[39,30,24,30],[40,8,25,8,"meta"],[40,12,25,12],[40,14,25,14,"context"],[40,21,25,21],[40,22,25,22,"meta"],[40,26,25,26],[41,8,26,8,"queryKey"],[41,16,26,16],[41,18,26,18,"context"],[41,25,26,25],[41,26,26,26,"queryKey"],[41,34,26,34],[42,8,27,8,"pageParam"],[42,17,27,17],[42,19,27,19,"context"],[42,26,27,26],[42,27,27,27,"pageParam"],[42,36,27,36],[43,8,28,8,"direction"],[43,17,28,17],[43,19,28,19,"context"],[43,26,28,26],[43,27,28,27,"direction"],[44,6,29,6],[44,7,29,7],[44,9,30,6],[44,15,30,12,"context"],[44,22,30,19],[44,23,30,20,"signal"],[44,29,30,26],[44,31,31,6],[44,37,31,12,"cancelled"],[44,46,31,21],[44,49,31,24],[44,53,32,4],[44,54,32,5],[45,6,33,4],[45,12,33,10,"stream"],[45,18,33,16],[45,21,33,19],[45,27,33,25,"streamFn"],[45,35,33,33],[45,36,33,34,"streamFnContext"],[45,51,33,49],[45,52,33,50],[46,6,34,4],[46,12,34,10,"isReplaceRefetch"],[46,28,34,26],[46,31,34,29,"isRefetch"],[46,40,34,38],[46,44,34,42,"refetchMode"],[46,55,34,53],[46,60,34,58],[46,69,34,67],[47,6,35,4],[47,17,35,15],[47,23,35,21,"chunk"],[47,28,35,26],[47,32,35,30,"stream"],[47,38,35,36],[47,40,35,38],[48,8,36,6],[48,12,36,10,"cancelled"],[48,21,36,19],[48,23,36,21],[49,10,37,8],[50,8,38,6],[51,8,39,6],[51,12,39,10,"isReplaceRefetch"],[51,28,39,26],[51,30,39,28],[52,10,40,8,"result"],[52,16,40,14],[52,19,40,17,"reducer"],[52,26,40,24],[52,27,40,25,"result"],[52,33,40,31],[52,35,40,33,"chunk"],[52,40,40,38],[52,41,40,39],[53,8,41,6],[53,9,41,7],[53,15,41,13],[54,10,42,8,"context"],[54,17,42,15],[54,18,42,16,"client"],[54,24,42,22],[54,25,42,23,"setQueryData"],[54,37,42,35],[54,38,43,10,"context"],[54,45,43,17],[54,46,43,18,"queryKey"],[54,54,43,26],[54,56,44,11,"prev"],[54,60,44,15],[54,64,44,20,"reducer"],[54,71,44,27],[54,72,44,28,"prev"],[54,76,44,32],[54,81,44,37],[54,86,44,42],[54,87,44,43],[54,90,44,46,"initialValue"],[54,102,44,58],[54,105,44,61,"prev"],[54,109,44,65],[54,111,44,67,"chunk"],[54,116,44,72],[54,117,45,8],[54,118,45,9],[55,8,46,6],[56,6,47,4],[57,6,48,4],[57,10,48,8,"isReplaceRefetch"],[57,26,48,24],[57,30,48,28],[57,31,48,29,"cancelled"],[57,40,48,38],[57,42,48,40],[58,8,49,6,"context"],[58,15,49,13],[58,16,49,14,"client"],[58,22,49,20],[58,23,49,21,"setQueryData"],[58,35,49,33],[58,36,49,34,"context"],[58,43,49,41],[58,44,49,42,"queryKey"],[58,52,49,50],[58,54,49,52,"result"],[58,60,49,58],[58,61,49,59],[59,6,50,4],[60,6,51,4],[60,13,51,11,"context"],[60,20,51,18],[60,21,51,19,"client"],[60,27,51,25],[60,28,51,26,"getQueryData"],[60,40,51,38],[60,41,51,39,"context"],[60,48,51,46],[60,49,51,47,"queryKey"],[60,57,51,55],[60,58,51,56],[60,62,51,60,"initialValue"],[60,74,51,72],[61,4,52,2],[61,5,52,3],[62,2,53,0],[63,0,53,1],[63,3]],"functionMap":{"names":["<global>","streamedQuery","<anonymous>","addConsumeAwareSignal$argument_1","addConsumeAwareSignal$argument_2","context.client.setQueryData$argument_1"],"mappings":"AAA;ACE;YCG,wCD;SCG;MCqB,oBD;MEC,sBF;UGa,+DH;GDQ;CDC"},"hasCjsExports":false},"type":"js/module"}]}